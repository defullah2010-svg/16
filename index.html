<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>برامج النشاط الطلابي</title>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
<script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
<script src="https://cdn.jsdelivr.net/npm/flatpickr/dist/l10n/ar.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.3/html2pdf.bundle.min.js"></script>

<style>
* { box-sizing: border-box; margin:0; padding:0; }
body { font-family: Arial, sans-serif; background:#f9f9f9; line-height:1.4; }

header {
  background:#15445a;
  color:white;
  text-align:center;
  padding:12px;
}
header h1 { font-size:18px; margin:0; }

.tab-content { padding:15px; }

label { display:block; margin:5px 0 2px; font-weight:bold; font-size:14px; text-align:center; }
input {
  width:100%; padding:6px; border:1px solid #c2c1c1;
  border-radius:6px; margin-bottom:5px; font-size:14px; text-align:center;
}

button {
  background:#b36b3f; color:white; border:none;
  padding:8px; margin:10px 0; cursor:pointer;
  border-radius:6px; width:100%; font-size:14px; font-weight:bold;
}

.grid-1 { display:grid; grid-template-columns:1fr; gap:5px; }
.grid-2 { display:grid; grid-template-columns:1fr 1fr; gap:5px; }
.grid-3 { display:grid; grid-template-columns:1fr 1fr 1fr; gap:5px; }

.preview { display:flex; flex-wrap:wrap; gap:5px; justify-content:center; margin-top:5px; }
.preview img {
  width:80px; height:70px; object-fit:cover;
  border:1px solid #ccc; border-radius:4px;
}
.del-btn {
  position:absolute; top:5px; left:50%; transform:translateX(-50%);
  width:22px; height:22px; background:#d50000; color:#fff;
  border:none; border-radius:50%; display:flex; align-items:center; justify-content:center;
  font-weight:bold; font-size:14px; cursor:pointer;
}

/* الطباعة */
@media print {
  button, input[type="file"], .del-btn { display:none !important; }
  .preview img { width:150px !important; height:130px !important; }
  .print-info { font-weight:bold; text-align:center; margin-top:10px; }
}
</style>
</head>
<body>

<header>
  <h1>برامج النشاط الطلابي</h1>
</header>

<div id="report" class="tab-content">
  <label style="font-size:16px;">استمارة توثيق برنامج</label>

  <div class="grid-2">
    <div><label>إدارة التعليم</label><input type="text" placeholder="الخرج"></div>
    <div><label>اسم المدرسة</label><input type="text" placeholder="المتوسطة السادسة عشر"></div>
  </div>

  <div class="grid-2">
    <div><label>اسم التقرير</label><input type="text"></div>
    <div><label>المجال</label><input type="text"></div>
  </div>

  <label>أهداف البرنامج</label>
  <div class="grid-3">
    <input type="text"><input type="text"><input type="text">
    <input type="text"><input type="text"><input type="text">
  </div>

  <div class="grid-3">
    <div><label>مدة التنفيذ</label><input type="text"></div>
    <div><label>مكان التنفيذ</label><input type="text"></div>
    <div><label>تاريخ التنفيذ</label><input type="text" class="date"></div>
  </div>

  <label>الوصف</label>
  <div class="grid-1">
    <input type="text"><input type="text">
  </div>

  <div class="grid-2">
    <div><label>الفئة المستهدفة</label><input type="text"></div>
    <div><label>عدد المستفيدين</label><input type="text"></div>
  </div>

  <label>القيمة</label>
  <div class="grid-1"><input type="text"><input type="text"></div>

  <label>مؤشر الإنجاز</label>
  <div class="grid-1"><input type="text"></div>

  <!-- الصور -->
  <input type="file" multiple accept="image/*" onchange="storeImages(event)">
  <div class="preview"></div>

  <!-- الأسماء -->
  <div class="grid-3" style="margin-top:5px;">
    <div><label>معلمة المجال</label><input type="text" id="domainTeacher"></div>
    <div><label>رائدة النشاط</label><input type="text" id="activityLeader" placeholder="وضحى النفيعي"></div>
    <div><label>مديرة المدرسة</label><input type="text" id="schoolPrincipal" placeholder="نوير العنزي"></div>
  </div>

  <button onclick="printPDF()">طباعة التقرير</button>
</div>

<script>
let uploadedImages = [];

function storeImages(event){
  const files = event.target.files;
  if(uploadedImages.length + files.length > 10){
    alert("مسموح برفع 10 صور فقط.");
    return;
  }
  for(let i=0;i<files.length;i++){
    const reader = new FileReader();
    reader.onload = e => { uploadedImages.push(e.target.result); updatePreview(); }
    reader.readAsDataURL(files[i]);
  }
}

function updatePreview(){
  const preview = document.querySelector('.preview');
  preview.innerHTML = '';
  uploadedImages.forEach((src,index)=>{
    const wrap = document.createElement('div');
    wrap.style.position='relative';
    const img = document.createElement('img');
    img.src = src;
    wrap.appendChild(img);
    const del = document.createElement('div');
    del.textContent = '×';
    del.className='del-btn';
    del.onclick = ()=>{ uploadedImages.splice(index,1); updatePreview(); };
    wrap.appendChild(del);
    preview.appendChild(wrap);
  });
}

function printPDF(){
  const report = document.getElementById('report').cloneNode(true);

  // إزالة العناصر غير المرغوبة
  report.querySelectorAll('button,input[type="file"],.del-btn').forEach(el=>el.remove());

  // نسخ القيم الحقيقية بدل placeholders
  report.querySelectorAll('input').forEach(inp=>{
    const val = inp.value.trim() || inp.placeholder || '';
    const span = document.createElement('div');
    span.textContent = val;
    span.style.borderBottom = "1px solid #ccc";
    span.style.marginBottom = "5px";
    inp.replaceWith(span);
  });

  // إضافة الصور في صف واحد
  if(uploadedImages.length>0){
    const imgRow = document.createElement('div');
    imgRow.style.display='flex';
    imgRow.style.flexWrap='nowrap';
    imgRow.style.justifyContent='center';
    imgRow.style.gap='20px';
    uploadedImages.forEach(src=>{
      const img=document.createElement('img');
      img.src=src;
      img.style.width='150px'; img.style.height='130px'; img.style.objectFit='cover';
      imgRow.appendChild(img);
    });
    report.appendChild(imgRow);

    // أسماء تحت الصور
    const info=document.createElement('div');
    info.className='print-info';
    info.innerHTML=`معلمة المجال: ${document.getElementById('domainTeacher').value} &nbsp;&nbsp; رائدة النشاط: ${document.getElementById('activityLeader').value || 'وضحى النفيعي'} &nbsp;&nbsp; مديرة المدرسة: ${document.getElementById('schoolPrincipal').value || 'نوير العنزي'}`;
    report.appendChild(info);
  }

  // خلفية A4
  const wrapper=document.createElement('div');
  wrapper.style.width='210mm';
  wrapper.style.minHeight='296mm';
  wrapper.style.backgroundImage="url('images/background.png')";
  wrapper.style.backgroundSize='100% 100%';
  wrapper.style.padding='20mm';
  wrapper.appendChild(report);

  html2pdf().set({
    filename:'report.pdf',
    pagebreak:{mode:['avoid-all']},
    html2canvas:{scale:2,backgroundColor:null}
  }).from(wrapper).save();
}
</script>

</body>
</html>
