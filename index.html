<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>برامج النشاط الطلابي</title>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
<script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
<script src="https://cdn.jsdelivr.net/npm/flatpickr/dist/l10n/ar.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.3/html2pdf.bundle.min.js"></script>

<style>
* { box-sizing: border-box; margin:0; padding:0; }
body {
  font-family: Arial, sans-serif;
  background:#f9f9f9;
  line-height:1.4;
}
header {
  background:#15445a;
  color:white;
  text-align:center;
  padding:12px;
}
header h1 { font-size:18px; }

.tab-content {
  padding:15px;
  width:100%;
  min-width:320px;
}

label {
  display:block;
  margin:5px 0 2px;
  font-weight:bold;
  font-size:14px;
  text-align:center;
}
input {
  width:100%;
  padding:6px;
  border:1px solid #c2c1c1;
  border-radius:6px;
  margin-bottom:5px;
  font-size:14px;
  text-align:center;
  background:transparent;
}
button {
  background:#b36b3f;
  color:white;
  border:none;
  padding:8px;
  margin:10px 0;
  cursor:pointer;
  border-radius:6px;
  width:100%;
  font-size:14px;
  font-weight:bold;
}
.grid-1 { display:grid; grid-template-columns:1fr; gap:5px; }
.grid-2 { display:grid; grid-template-columns:1fr 1fr; gap:5px; }
.grid-3 { display:grid; grid-template-columns:1fr 1fr 1fr; gap:5px; }

.preview { display:flex; flex-wrap:wrap; gap:5px; justify-content:center; margin-top:5px; position:relative; }
.preview div { position:relative; }
.preview img {
  width:80px;
  height:70px;
  object-fit:cover;
  border:1px solid #ccc;
  border-radius:4px;
}
.del-btn {
  position:absolute;
  top:2px;
  left:2px;
  width:20px;
  height:20px;
  background:#d50000;
  color:#fff;
  border:none;
  border-radius:50%;
  display:flex;
  align-items:center;
  justify-content:center;
  font-weight:bold;
  font-size:14px;
  cursor:pointer;
}
.print-info {
  font-weight:bold;
  text-align:center;
  margin-top:10px;
}

/* عند الطباعة */
@media print {
  button, input[type="file"], .del-btn, .counter { display:none !important; }
  .preview img {
    width:150px !important;
    height:130px !important;
  }
}
</style>
</head>
<body>

<header>
  <h1>برامج النشاط الطلابي</h1>
</header>

<div id="culture" class="tab-content active">
  <label style="font-size:16px;">استمارة توثيق برنامج</label>

  <div class="grid-2">
    <div><label>إدارة التعليم</label><input type="text" placeholder="الخرج"></div>
    <div><label>اسم المدرسة</label><input type="text" placeholder="المتوسطة السادسة عشر"></div>
  </div>

  <div class="grid-2">
    <div><label>اسم التقرير</label><input type="text"></div>
    <div><label>المجال</label><input type="text"></div>
  </div>

  <label>أهداف البرنامج</label>
  <div class="grid-3">
    <input type="text"><input type="text"><input type="text">
    <input type="text"><input type="text"><input type="text">
  </div>

  <div class="grid-3">
    <div><label>مدة التنفيذ</label><input type="text"></div>
    <div><label>مكان التنفيذ</label><input type="text"></div>
    <div><label>تاريخ التنفيذ</label><input type="text" class="date"></div>
  </div>

  <label>الوصف</label>
  <div class="grid-1">
    <input type="text"><input type="text">
  </div>

  <div class="grid-2">
    <div><label>الفئة المستهدفة</label><input type="text"></div>
    <div><label>عدد المستفيدين</label><input type="text"></div>
  </div>

  <label>القيمة</label>
  <div class="grid-1">
    <input type="text"><input type="text">
  </div>

  <label>مؤشر الإنجاز</label>
  <div class="grid-1"><input type="text"></div>

  <label>التحديات والصعوبات</label>
  <div class="grid-3"><input type="text"><input type="text"><input type="text"></div>

  <!-- رفع الصور -->
  <input type="file" multiple accept="image/*" onchange="storeImages(event)">
  <div class="counter"></div>
  <div class="preview"></div>

  <!-- أسماء المعلمات -->
  <div class="grid-3" style="margin-top:5px;">
    <div><label>معلمة المجال</label><input id="domainTeacher" type="text"></div>
    <div><label>رائدة النشاط</label><input id="activityLeader" type="text" placeholder="وضحى النفيعي"></div>
    <div><label>مديرة المدرسة</label><input id="schoolPrincipal" type="text" placeholder="نوير العنزي"></div>
  </div>

  <button onclick="printPDF()">طباعة التقرير</button>
</div>

<script>
let uploadedImages = [];

function storeImages(event){
  const files = event.target.files;
  if(uploadedImages.length + files.length > 10){
    alert("مسموح برفع 10 صور فقط لكل تقرير.");
    event.target.value = "";
    return;
  }
  for(let i=0;i<files.length;i++){
    const reader = new FileReader();
    reader.onload = function(e){ 
      uploadedImages.push(e.target.result); 
      updatePreview();
    }
    reader.readAsDataURL(files[i]);
  }
}
function updatePreview(){
  const preview = document.querySelector(".preview");
  preview.innerHTML = "";
  uploadedImages.forEach((src,idx)=>{
    const div = document.createElement("div");
    const img = document.createElement("img");
    img.src = src;
    const del = document.createElement("button");
    del.textContent="×";
    del.className="del-btn";
    del.onclick=()=>{ uploadedImages.splice(idx,1); updatePreview(); };
    div.appendChild(img);
    div.appendChild(del);
    preview.appendChild(div);
  });
}
function printPDF(){
  // قراءة أسماء
  const domainTeacher = document.getElementById("domainTeacher").value || "____";
  const activityLeader = document.getElementById("activityLeader").value || document.getElementById("activityLeader").placeholder;
  const schoolPrincipal = document.getElementById("schoolPrincipal").value || document.getElementById("schoolPrincipal").placeholder;

  // الصور في صف واحد
  const imagesWrapper = document.createElement("div");
  imagesWrapper.style.display="flex";
  imagesWrapper.style.flexWrap="nowrap";
  imagesWrapper.style.justifyContent="center";
  imagesWrapper.style.gap="15px";
  imagesWrapper.style.margin="15px 0";

  uploadedImages.forEach(src=>{
    const img=document.createElement("img");
    img.src=src;
    img.style.width="150px";
    img.style.height="130px";
    img.style.objectFit="cover";
    imagesWrapper.appendChild(img);
  });

  // نسخة للطباعة
  const content=document.querySelector(".tab-content").cloneNode(true);
  content.querySelectorAll('button,input[type="file"],.del-btn,.counter,.preview').forEach(el=>el.remove());
  const lastRow=content.querySelector('.grid-3:last-of-type');
  if(lastRow) lastRow.after(imagesWrapper);
  else content.appendChild(imagesWrapper);

  const infoRow=document.createElement("div");
  infoRow.className="print-info";
  infoRow.textContent=`معلمة المجال: ${domainTeacher}   رائدة النشاط: ${activityLeader}   مديرة المدرسة: ${schoolPrincipal}`;
  imagesWrapper.after(infoRow);

  // نافذة الطباعة
  const printWindow=window.open("", "_blank");
  printWindow.document.write("<html><head><title>تقرير</title></head><body>"+content.innerHTML+"</body></html>");
  printWindow.document.close();
  printWindow.print();
}
</script>
</body>
</html>
